<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-REW7E7RH9B"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-REW7E7RH9B');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¤é£²æ•¸ä½è½‰å‹ 3.0 | LINE LIFF + Hugging Face æ··åˆé›²ç«¯è¨‚ä½ç³»çµ± | CIE CIE TAIPEI</title>
    <meta name="description" content="é¤é£²æ•¸ä½è½‰å‹é€²éšç‰ˆ v3.0ã€‚æ•™ä½ ç”¨ LINE LIFF + Python (Gradio) + Supabase æ‰“é€ èƒ½è‡ªå‹•è¾¨è­˜ç†Ÿå®¢ã€æ··åˆç™¼é€ LINE/Email é€šçŸ¥çš„ä¼æ¥­ç´šè¨‚ä½ç³»çµ±ã€‚">
    <meta property="og:type" content="website" />
    <meta property="og:title" content="CIE CIE TAIPEI | å°åŒ— 101 è·¨å¹´é¤å»³é¦–é¸ | ä¿¡ç¾©å®‰å’Œé¤é…’é¤¨" />
    <meta property="og:description" content="å¤§å®‰å€é…’å§ï¼Œæä¾›é«˜è³ªæ„Ÿèª¿é…’èˆ‡ç¾©å¼é¤é»ã€‚ç«‹å³ç·šä¸Šè¨‚ä½ï¼Œäº«å—å¾®é†ºæ™‚å…‰ã€‚" />
    <meta property="og:image" content="https://ciecietaipei.github.io/assets/ciecie-image_1f-1.jpg" />
    <meta property="og:url" content="https://ciecietaipei.github.io/" />
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* æ–‡ç« é é¢å°ˆç”¨ CSS */
        .article-content {
            max-width: 900px;
            margin: 0 auto;
            text-align: left;
            line-height: 1.8;
            color: #dcdcdc;
        }
        
        .article-content h3 {
            color: #d4af37;
            margin-top: 40px;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 10px;
        }

        .article-content h4 {
            color: #ffc107;
            margin-top: 20px;
            font-size: 1.1em;
        }

        .article-content ul, .article-content ol {
            padding-left: 40px;
            margin-bottom: 20px;
        }

        .article-content li {
            margin-bottom: 10px;
        }

        .article-content b, .article-content strong {
            color: #fff;
        }
        
        .article-content a {
            color: #d4af37;
            text-decoration: underline;
        }

        .article-image-container {
            text-align: center;
            margin: 30px 0;
        }
        
        .article-image-container img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .step-block {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        /* ç¨‹å¼ç¢¼å€å¡Šæ¨£å¼ */
        pre {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            border: 1px solid #444;
        }
        
        code {
            color: #d4af37;
            background: rgba(255,255,255,0.1);
            padding: 2px 5px;
            border-radius: 3px;
        }

        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <header class="hero" id="home">
        <div class="hero-overlay"></div>
        <div class="hero-content" style="justify-content: flex-start; padding-top: 80px; height: auto; min-height: 100vh;">
            <a href="#" class="logo-trigger">
                <img loading="lazy" src="assets/ciecie_logo_circle.png" alt="Cie Cie Taipei Logo" class="hero-logo">
            </a>

<div class="quick-anchors" style="display: flex; flex-direction: column; align-items: center; gap: 10px;">

    <a href="./booking.html"
       class="btn btn-warning shadow pulse-effect"
       target="_top"
       style="background-color: #ffc107; color: #000; padding: 12px 30px; border-radius: 50px; font-weight: bold; font-size: 1.1rem; text-decoration: none; margin-bottom: 10px;">
       ğŸ“… é¦¬ä¸Šè¨‚ä½
    </a>

    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-bottom: 15px;">
        <a href="./FAQ.html" class="qa-link" target="_top" style="color: white; text-decoration: none; border-bottom: 1px solid white;">FAQ</a>
        <a href="./drinks.html" class="qa-link" style="color: white; text-decoration: none; border-bottom: 1px solid white;">æŸ¥çœ‹é…’å–®</a>
        <a href="./foods.html" class="qa-link" style="color: white; text-decoration: none; border-bottom: 1px solid white;">ç²¾ç·»é¤é»</a>
        <a href="./environment.html" class="qa-link" style="color: white; text-decoration: none; border-bottom: 1px solid white;">ç’°å¢ƒä»‹ç´¹</a>
        <a href="https://drive.google.com/drive/folders/1z6CMGhriXizFs7NFf7QHYJ3_9K8njPaa" target="_blank" class="qa-link" style="color: white; text-decoration: none; border-bottom: 1px solid white;">å®Œæ•´èœå–® (PDF)</a>
    </div>

    <div style="display: flex; justify-content: center; gap: 20px;">
        <a href="./AppsScripts-Booking.html" class="qa-link" style="color: #ccc; font-size: 0.9em;">AppsScriptsæ•¸ä½è½‰å‹</a>
        <a href="./HuggingFace-Booking.html" class="qa-link" style="color: #ccc; font-size: 0.9em;">HuggingFaceæ•¸ä½è½‰å‹</a>
    </div>

            <div class="hero-social-links">
                <a href="https://www.facebook.com/ciecietaipei/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a href="https://lin.ee/2nxT8n1" target="_blank"><i class="fab fa-line"></i></a>
                <a href="https://www.instagram.com/ciecietaipei" target="_blank"><i class="fab fa-instagram"></i></a>
            </div>

            <h1>CIE CIE TAIPEI</h1>
            <a href="https://maps.app.goo.gl/WSmBry9GLkLZT45o8" class="cta-button pulse-effect" target="_blank"><i class="fas fa-map-marker-alt"> å°åŒ—å¸‚å¤§å®‰å€ä¿¡ç¾©è·¯å››æ®µ390è™Ÿ <br><br> 02-2709-3446</i></a>
        </div>
    </header>

    <section class="section menu" id="article">
        <p class="ambiance-text">
            <a href="index.html" target="_TOP" class="full-menu-link">å›é¦–é </a>
        </p>

        <div class="article-content">
            <p style="text-align: center;">
                <b><span style="font-size: x-large;">ã€Œ<a href="https://blog.twman.org/2025/11/booking.html" target="_blank">é¤é£²æ•¸ä½è½‰å‹ 3.0ï¼šLINE LIFF + æ··åˆé›²ç«¯è¨‚ä½</a>ã€</span></b>
            <p class="ambiance-text" style="text-align: justify;">
                é€™æ˜¯ã€Œ<a href="AppsScripts-Booking.html" target="_TOP">Google Sheets è¨‚ä½ç³»çµ±</a>ã€çš„çµ‚æ¥µé€²åŒ–ç‰ˆã€‚æˆ‘å€‘çµåˆäº† <b>LINE LIFF</b> æŠ€è¡“ï¼Œè®“å¾å®˜æ–¹å¸³è™Ÿé»é€²ä¾†çš„ç†Ÿå®¢èƒ½<b>ã€Œå…ç™»å…¥è‡ªå‹•æŠ“å– IDã€</b>ï¼Œä¸¦åœ¨è¨‚ä½æˆåŠŸå¾Œæ”¶åˆ° LINE æ¨æ’­ï¼›è€Œä¸€èˆ¬è·¯äººå‰‡èµ°è¨ªå®¢æ¨¡å¼æ”¶ Emailã€‚é€™å¥— <b>Hugging Face + Supabase + LINE</b> çš„æ··åˆæ¶æ§‹ï¼Œèƒ½è®“æ‚¨åœ¨<b>é›¶æœˆè²»</b>çš„å‰æä¸‹ï¼Œæ“æœ‰åª²ç¾ Inline çš„å•†æ¥­ç´šåŠŸèƒ½ã€‚
            </p>

            <div class="step-block" id="architecture">
                <h3>ğŸ›ï¸ ç³»çµ±æ¶æ§‹ (System Architecture v3.0)</h3>
                <ul>
                    <li><b>æ ¸å¿ƒå¤§è…¦ (Database)</b>ï¼šSupabase (æ–°å¢ <code>user_id</code> æ¬„ä½)ã€‚</li>
                    <li><b>èº«ä»½è­˜åˆ¥ (Identity)</b>ï¼šLINE Login Channel (LIFF) â” è‡ªå‹•æŠ“å– User IDã€‚</li>
                    <li><b>é¡§å®¢å…¥å£ (Space A)</b>ï¼šPython å‰ç«¯ â” æ¥æ”¶è¨‚å–®ã€é˜²å‘†ã€å³æ™‚å¯«å…¥ã€‚</li>
                    <li><b>è€é—†å¾Œå° (Space B)</b>ï¼šPython å¾Œå° â” æ··åˆç™¼ä¿¡ (æœ‰ ID ç™¼ LINEï¼Œæ²’ ID ç™¼ Email)ã€‚</li>
                    <li><b>é€šçŸ¥ç®¡é“</b>ï¼šLINE Messaging API (ç†Ÿå®¢) + Google Apps Script (Email ä¿åº•)ã€‚</li>
                </ul>
            </div>

            <div class="step-block">
                <h3>ğŸ› ï¸ æº–å‚™å·¥ä½œ (Pre-requisites)</h3>
                <ul>
                    <li><b>Hugging Face</b> å¸³è™Ÿ (éƒ¨ç½²ç¨‹å¼)ã€‚</li>
                    <li><b>Supabase</b> å¸³è™Ÿ (è³‡æ–™åº«)ã€‚</li>
                    <li><b>LINE Developers</b> å¸³è™Ÿ (éœ€å»ºç«‹å…©å€‹ Channel)ã€‚</li>
                    <li><b>Google</b> å¸³è™Ÿ (ç”¨æ–¼ GAS ç™¼ä¿¡)ã€‚</li>
                </ul>
            </div>

            <h3>æ­¥é©Ÿä¸€ï¼šå»ºç«‹è³‡æ–™åº« (Supabase)</h3>
            <p>å»ºç«‹å„²å­˜è¨‚å–®çš„è¡¨æ ¼ï¼Œè¨˜å¾—åŒ…å« <code>user_id</code>ã€‚</p>
            <ul>
                <li>ç™»å…¥ <a href="https://supabase.com/" target="_blank">Supabase</a>ï¼Œé€²å…¥ <b>SQL Editor</b>ï¼ŒåŸ·è¡Œï¼š</li>
            </ul>
            <pre>
create table bookings (
    id bigint generated by default as identity primary key,
    created_at timestamp with time zone default timezone('utc'::text, now()) not null,
    name text not null,     -- å§“å
    tel text not null,      -- é›»è©±
    email text,             -- Email
    date text not null,     -- æ—¥æœŸ
    time text not null,     -- æ™‚é–“
    pax int not null,       -- äººæ•¸
    remarks text,           -- å‚™è¨»
    status text default 'å¾…è™•ç†', -- ç‹€æ…‹
    user_id text            -- [v3.0æ–°å¢] å­˜æ”¾ LINE User ID
);</pre>
            <ul>
                <li>è¨˜ä¸‹ <code>Project URL</code> èˆ‡ <code>anon public key</code>ã€‚</li>
            </ul>

            <h3>æ­¥é©ŸäºŒï¼šè¨­å®š LINE é–‹ç™¼è€…å¸³è™Ÿ</h3>
            <p>æˆ‘å€‘éœ€è¦å…©å€‹ Channel ä¾†åˆ†å·¥ï¼š</p>
            <ol>
                <li><b>Messaging API Channel</b>ï¼šè² è²¬ã€Œç™¼é€é€šçŸ¥ã€ã€‚
                    <ul><li>å–å¾— <code>Channel Access Token</code>ã€‚</li></ul>
                </li>
                <li><b>LINE Login Channel</b>ï¼šè² è²¬ã€ŒLIFF èº«ä»½è­˜åˆ¥ã€ã€‚
                    <ul>
                        <li>å»ºç«‹å¾Œè‡³ <b>LIFF</b> é ç±¤ï¼Œé»æ“Š <b>Add</b>ã€‚</li>
                        <li><b>Endpoint URL</b> å¡«å…¥æ‚¨çš„å®˜ç¶²è¨‚ä½é ï¼š<code>https://ciecietaipei.github.io/booking.html</code></li>
                        <li><b>Scopes</b> å‹¾é¸ <code>openid</code>, <code>profile</code>ã€‚</li>
                        <li>è¨˜ä¸‹ç”¢ç”Ÿçš„ <b>LIFF ID</b>ã€‚</li>
                    </ul>
                </li>
            </ol>

            <h3>æ­¥é©Ÿä¸‰ï¼šéƒ¨ç½²é¡§å®¢å‰ç«¯ (Space A)</h3>
            <p>è² è²¬é¡¯ç¤ºè¡¨å–®ä¸¦æ¥æ”¶ LIFF å‚³ä¾†çš„ IDã€‚</p>
            <ul>
                <li>åœ¨ Hugging Face å»ºç«‹ Space (Gradio)ã€‚</li>
                <li>è¨­å®š <b>Secrets</b>ï¼š<code>SUPABASE_URL</code>, <code>SUPABASE_KEY</code>, <code>LINE_ACCESS_TOKEN</code>, <code>LINE_ADMIN_ID</code>ã€‚</li>
                <li>åœ¨ <code>app.py</code> ä¸­ï¼ŒåŠ å…¥æŠ“å– URL åƒæ•¸çš„é‚è¼¯ï¼š</li>
            </ul>
            <pre>
# æŠ“å– LIFF å‚³ä¾†çš„ ID
def get_line_id_from_url(request: gr.Request):
    if request: return request.query_params.get("line_id", "")
    return ""

# å¯«å…¥è³‡æ–™åº«
def handle_booking(name, tel, ..., line_id):
    data = { ..., "user_id": line_id }
    supabase.table("bookings").insert(data).execute()
            </pre>

            <h3>æ­¥é©Ÿå››ï¼šéƒ¨ç½²è€é—†å¾Œå° (Space B)</h3>
            <p>è² è²¬å¯©æ ¸è¨‚å–®ï¼Œä¸¦è‡ªå‹•åˆ¤æ–·ç™¼é€ç®¡é“ã€‚</p>
            <ul>
                <li>å»ºç«‹ç¬¬äºŒå€‹ Spaceï¼Œè¨­å®š <b>Secrets</b> (å« <code>GAS_MAIL_URL</code>)ã€‚</li>
                <li>åœ¨ <code>app.py</code> ä¸­ï¼Œå¯¦ä½œæ··åˆç™¼é€é‚è¼¯ï¼š</li>
            </ul>
            <pre>
def send_confirmation_hybrid(booking_id):
    # 1. æŠ“å–è¨‚å–®è³‡æ–™
    booking = supabase.table("bookings").select("*").eq("id", booking_id).execute().data[0]
    
    # 2. ç™¼é€ Email (ä¿åº•)
    requests.post(GAS_MAIL_URL, json={...})
    
    # 3. è‹¥æœ‰ user_idï¼ŒåŠ ç™¼ LINE é€šçŸ¥
    if booking['user_id']:
        requests.post("https://api.line.me/v2/bot/message/push", ...)
            </pre>

            <h3>æ­¥é©Ÿäº”ï¼šç¶²ç«™æ•´åˆ (booking.html)</h3>
            <p>æœ€é—œéµçš„ä¸€æ­¥ï¼šåœ¨ç¶²é ä¸­æ¤å…¥ LIFF SDKï¼Œè®“å®ƒè‡ªå‹•é‹ä½œã€‚</p>
            <pre>
&lt;script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"&gt;&lt;/script&gt;
&lt;script&gt;
    const MY_LIFF_ID = "æ‚¨çš„_LIFF_ID"; 
    const HF_SPACE_URL = "æ‚¨çš„_Space_A_ç¶²å€";

    async function initLiff() {
        await liff.init({ liffId: MY_LIFF_ID });
        // è‹¥åœ¨ LINE å…§é–‹å•Ÿï¼Œè‡ªå‹•æŠ“ ID ä¸¦è½‰å€
        if (liff.isLoggedIn()) {
            const profile = await liff.getProfile();
            document.getElementById('booking-frame').src = `${HF_SPACE_URL}&line_id=${profile.userId}`;
        } else {
            // è‹¥åœ¨ç€è¦½å™¨é–‹å•Ÿï¼Œç•¶ä½œè¨ªå®¢
            document.getElementById('booking-frame').src = HF_SPACE_URL;
        }
    }
    window.onload = initLiff;
&lt;/script&gt;</pre>

            <h3>âš ï¸ é‡è¦æ“ä½œæé†’</h3>
            <ul>
                <li><b>LINE å®˜æ–¹å¸³è™Ÿè¨­å®š</b>ï¼šè«‹å°‡åœ–æ–‡é¸å–®çš„ã€Œç«‹å³è¨‚ä½ã€é€£çµæ”¹ç‚º LIFF ç¶²å€ (<code>https://liff.line.me/æ‚¨çš„ID</code>)ï¼Œé€™æ¨£æ‰èƒ½è§¸ç™¼è‡ªå‹•ç™»å…¥ã€‚</li>
                <li><b>Supabase é˜²ä¼‘çœ </b>ï¼šå…è²»ç‰ˆè‹¥ 7 å¤©ç„¡æ´»å‹•æœƒæš«åœï¼Œå»ºè­°æ¯é€±ç™»å…¥ä¸€æ¬¡å¾Œå°ã€‚</li>
                <li><b>æ™‚å€è¨­å®š</b>ï¼šç¨‹å¼ç¢¼ä¸­å·²åŒ…å« <code>TAIPEI_TZ</code>ï¼Œç¢ºä¿è¨‚ä½æ™‚é–“æº–ç¢ºã€‚</li>
            </ul>

            <p class="ambiance-text" style="text-align: center;">
                å®Œæˆä»¥ä¸Šè¨­å®šï¼Œæ‚¨å°±æ“æœ‰äº†ä¸€å¥—ã€Œé€²å¯æ”» (LINE è¡ŒéŠ·)ã€é€€å¯å®ˆ (Email é€šçŸ¥)ã€çš„å…¨æ–¹ä½è¨‚ä½ç³»çµ±ï¼
            </p>

        </div>
    </section>

    <footer>
        <a href="https://blog.twman.org/p/ciecietaipei.html" target="_blank"><p>Â© 2026 CIE CIE TAIPEI. All Rights Reserved.</p></a>
        <p class="footer-note">æœªæ»¿åå…«æ­²è«‹å‹¿é£²é…’ã€‚å–é…’ä¸é–‹è»Šï¼Œé–‹è»Šä¸å–é…’ã€‚</p>
        <p class="footer-note">ğŸ“åº—å®¶åœ°å€ï¼šå¤§å®‰å€ä¿¡ç¾©è·¯å››æ®µ390è™Ÿ ğŸ“è¨‚ä½å°ˆç·šï¼š02-2709-3446</p>
    </footer>

    <div class="mobile-sticky-bar">
        <a href="environment.html" target="_TOP" class="sticky-btn menu-btn">
            <i class="fas fa-store"></i> ç’°å¢ƒ
        </a>
        <a href="foods.html" target="_TOP" class="sticky-btn menu-btn">
            <i class="fas fa-utensils"></i> âœ¦é¤âœ¦
        </a>
        <a href="./booking.html" class="sticky-btn booking-btn">
            <i class="far fa-calendar-check"></i> âœ¦è¨‚ä½âœ¦
        </a>
        <a href="drinks.html" target="_TOP" class="sticky-btn menu-btn">
            <i class="fas fa-wine-glass-alt"></i> âœ¦é…’âœ¦
        </a>
        <a href="FAQ.html" target="_TOP" class="sticky-btn menu-btn">
            <i class="fas fa-question-circle"></i> FAQ
        </a>
    </div>
</body>
</html>